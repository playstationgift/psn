/*!
 * @sie/designkit
 * @copyright     2024 Sony Interactive Entertainment LLC, all rights reserved
 */

!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function o(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function i(e){var t=n(e,"string");return"symbol"==typeof t?t:String(t)}var a=9,s=["a[href]:not([disabled])",'div[role="button"]',"button:not([disabled])","textarea:not([disabled])",'input[type="text"]:not([disabled])','input[type="radio"]:not([disabled])','input[type="checkbox"]:not([disabled])',"select:not([disabled])",'[data-component="video-block"]'],d=[".age-gate:not(.display--hidden)",".media-lightbox.show"],l=function(){function t(o,n){e(this,t),this.$last=$(document.activeElement),this.$doc=n?n:_gpdc.elements.$document,this.$target=o,this.$focusable=o.find(s.join(", ")),this.focusLimit=this.$focusable.length-1,this.focusIndex=null,this.onKeyDown=this.onKeyDown.bind(this),this.$doc.on("keydown.dkFocusTrap",this.onKeyDown)}return o(t,[{key:"destroy",value:function(){this.$doc.off("keydown.dkFocusTrap",this.onKeyDown),this.$last.focus()}},{key:"autoFocusFirstItem",value:function(){this.focusLimit&&(this.focusIndex=0,this.$focusable.eq(this.focusIndex).focus())}},{key:"onKeyDown",value:function(e){var t="Tab"===e.key||e.keyCode===a;!this.isExcluded()&&t&&(e.preventDefault(),e.shiftKey?this.focusIndex=null!==this.focusIndex?this.focusIndex-1:this.focusLimit:this.focusIndex=null!==this.focusIndex?this.focusIndex+1:0,this.focusIndex<0?this.focusIndex=this.focusLimit:this.focusIndex>this.focusLimit&&(this.focusIndex=0),this.$focusable.eq(this.focusIndex).focus())}},{key:"isExcluded",value:function(){return $(d.join(", ")).length}}]),t}(),c=({endpoint:_gpdc.elements.$body.data("wc-api"),arkhamAPIHost:_gpdc.elements.$body.data("arkham-api"),arkhamAPIPath:"/api/session/v1/signin?redirect_uri=CURRENT_PAGE_URL&flow=web:walletAdmin",loadingClass:"loading",loadedAction:"checkout_app_visible",loginAction:"checkout_signin_required",pswrdVerifAction:"checkout_password_verification_required",closeActions:["checkout_cart_cancel","checkout_continue_shopping","checkout_error_dismiss","checkout_thankyou_dismiss"]},"no-scroll"),r="curtain",u="curtain__blur",h=function(e,t){var o="addClass"===e?"on":"off";$("html, body")[e](c),t&&t.length&&t[o]("touchmove.dkUtilsLockScreen",function(e){return e.preventDefault(),e.stopPropagation(),!1})},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"100",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"dark",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=$(".modal.modal--visible"),a=n?[r,n]:[r],s=i.length&&!e;return new Promise(function(n,i){var d=$(".".concat(a.join(".").trim())),l=[o,"opacity--".concat(t)];d.length||(d=$('<div class="'.concat(a.join(" "),'" />')),$("#gdk__content").append(d)),d[0].$wrapper||(d[0].$wrapper=$(".cmp-container")),e?(d.removeClass("display--hidden"),setTimeout(function(){d.addClass(l)},10),setTimeout(function(){d[0].$wrapper.addClass(u)},250)):(!s&&d[0].$wrapper.removeClass(u),d.removeClass(l),setTimeout(function(){d.attr("class","".concat(a.join(" ")," display--hidden"))},250)),s||h(e?"addClass":"removeClass",d),n()})},p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#gdk__content",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(n,i){var a=($(e).html()||"").trim();if(a){if(o){var s=$($.parseHTML(a)).addClass(e.replace(/^#+/,""));$(t).append(s)}else $(t).append($.parseHTML(a));n("success")}else i("failure")})},m="modal-curtain",g=function(){function t(){e(this,t),_gpdc.Logger.logInitializer("modals","components","Modal")}return o(t,[{key:"init",value:function(){var e=this;$('template[id*="modal-"]').length&&(this.createModal=this.createModal.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.display=this.display.bind(this),this.hide=this.hide.bind(this),_gpdc.components.Modal={create:this.createModal,display:this.display,hide:this.hide},this.get("#modal-template").then(function(t){e.classes={modalVisible:"modal--visible",headerPinned:"modal__header--pinned"},e.template=t.html,e.$gdk=$("#gdk__content"),e.$doc=_gpdc.elements.$document,e.listen(),e.triggers(),_gpdc.elements.$document.trigger("modalClassReady.dkModals")}).catch(function(){_gpdc.Logger.warn("Modals base template wasn't found.")}))}},{key:"triggerFromQuery",value:function(){var e=new URLSearchParams(location.search),t=e.get("modal");t&&this.show({modalId:t})}},{key:"triggerAtPageLoad",value:function(){if(!$(".".concat(this.classes.modalVisible)).length){var e=$('[data-modal-auto-show="true"]').eq(0);if(e.length){var t=e.attr("id").replace("modal-",""),o=e.data("modal-auto-frequency"),n="modal-".concat(t,"-shown"),i="always"===o||("once"!==o||null===sessionStorage.getItem(n));"once"===o&&i&&sessionStorage.setItem(n,!0),i&&this.show({modalId:t})}}}},{key:"triggers",value:function(e){this.triggerFromQuery(),this.triggerAtPageLoad()}},{key:"get",value:function(e){return new Promise(function(t,o){var n=$(e);n.length||o(e),t({html:$.parseHTML(n.html()),$target:n})})}},{key:"listen",value:function(){var e=_gpdc.elements.$body;$("[data-modal-id]").on("click.dkModals",this.onTriggerClick.bind(this)),e.on("click.dkModals",".modal__close, [data-modal-close]",this.onCloseModalClick.bind(this))}},{key:"onTriggerClick",value:function(e){e&&e.preventDefault(),this.show($(e.currentTarget).data())}},{key:"onCloseModalClick",value:function(e){e&&e.preventDefault(),this.hide($(e.currentTarget).closest(".modal"))}},{key:"createModal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=$(this.template).clone();return o.addClass(t),o.find(".modal__content").html(e),this.$gdk.append(o),o}},{key:"find",value:function(e){var t=this;return this.get("#modal-".concat(e)).then(function(e){var o=t.createModal(e.html);return{$modal:o,$template:e.$target}})}},{key:"prepareModal",value:function(e){var t=this;new _gpdc.components.Accordion(e).init(),new _gpdc.components.InlineVideo(e).init(),new _gpdc.components.VideoBlock(e).init(),new _gpdc.components.ImageBlock(e).init(),_gpdc.components.BGBlock(e),_gpdc.components.lozad._observer.observe(),this.$doc.on("keyup.dkModals",this.onKeyUp),this.focusTrap=new l(e,this.$doc),e.find('a[href^="#"]').on("click.dkModals",function(){$(".".concat(t.classes.modalVisible)).find(".modal__close").trigger("click")})}},{key:"onKeyUp",value:function(e){this.focusTrap.isExcluded()||"Escape"!==e.key&&"Esc"!==e.key&&27!==e.keyCode||(e.stopPropagation(),$(".".concat(this.classes.modalVisible)).find(".modal__close").trigger("click"))}},{key:"onModalBackdropClick",value:function(e){e.target===e.currentTarget&&this.hide($(e.currentTarget).closest(".modal"))}},{key:"display",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=o.modalTheme,a=void 0===i?"dark":i,s=o.modalStyle,d=void 0===s?"popup":s,l=o.modalAnimation,c=void 0===l?"fade":l;e.attr({"data-style":d,"data-theme":a,"data-animation":c}),e.find(".modal__content").addClass("theme--".concat(a)),this.prepareModal(e),setTimeout(function(){e.addClass(t.classes.modalVisible)},100),f(!0,"80",n?n:a,m),e.find(".modal__content").addClass("theme--".concat(a)),e.find(".modal__grid").on("click.dkModals",this.onModalBackdropClick.bind(this));var r=e.find(".modal__body");r.data("$header",r.find(".modal__header")),r.on("scroll.dkModals",this.onScroll.bind(this))}},{key:"show",value:function(e){var t=this;this.find(e.modalId).then(function(o){var n=o.$modal,i=o.$template;t.display(n,$.extend(Object.assign({},i.data()),e))}).catch(function(t){console.log(t),_gpdc.Logger.warn("Unable to find LightBox HTML Template for: ".concat(e.modalId))})}},{key:"hide",value:function(e){e.removeClass(this.classes.modalVisible),e.find(".modal__body").off("scroll.dkModals",this.onScroll.bind(this)),setTimeout(function(){f(!1,"80","dark",m),e.trigger("hide.dkModals"),e.remove()},150),this.$doc.off("keyup.dkModals",this.onKeyUp),this.focusTrap&&(this.focusTrap.destroy(),this.focusTrap=null)}},{key:"onScroll",value:function(e){var t=$(e.currentTarget),o=t.data("$header"),n=this.classes.headerPinned;t.scrollTop()>0&&!o.hasClass(n)?o.addClass(n):t.scrollTop()<=0&&o.hasClass(n)&&o.removeClass(n)}}]),t}(),v="retail-modal-curtain",k=function(){function t(){e(this,t)}return o(t,[{key:"closeModal",value:function(e){e.removeClass("show"),f(!1,"80","light",v).then(function(e){}).catch(function(e){_gpdc.Logger.warn("Unable to Close Retail Modal!!")})}},{key:"showModal",value:function(e){var t=this,o=$(".modal__wrapper.".concat(e));o.length?(f(!0,"80","light",v).then(function(e){}).catch(function(e){_gpdc.Logger.log("Unable to Create Retail Modal Curtain!!")}),$(".".concat(e)).addClass("show"),_gpdc.components.lozad._observer.observe()):p("#".concat(e),"#gdk__content",!0).then(function(o){var n=$(".".concat(e)),i=n.find(".modal__close");i.length&&i.on("click dkPsRetailerCloseModal",function(){t.closeModal(n)}),n.addClass("show"),_gpdc.components.lozad._observer.observe(),f(!0,"80","light",v).then(function(e){}).catch(function(e){_gpdc.Logger.log("Unable to Create Retail Modal Curtain!!")})}).catch(function(e){_gpdc.Logger.log("Unable to find Modal HTML Template!!")})}},{key:"init",value:function(){var e=this,t=$("[data-modal-open-retail]");t&&t.length&&($.each(t,function(t,o){var n=$(o),i=n.data("modal-open-retail");n.on("click.dkPsRetailerModalOpenButton",function(){e.showModal(i)})}),_gpdc.Logger.logInitializer("modals","components","Retail"))}}]),t}(),y=function(){function t(){var o=this;e(this,t),window._gpdc&&_gpdc.user&&"undefined"!=typeof _gpdc.user.isLoggedIn?this.initModules():_gpdc.elements.$document.one("userInfoSet.dkComponents",function(){return o.initModules()})}return o(t,[{key:"initModules",value:function(){(new g).init(),(new k).init()}}]),t}();!function(e){_gpdc.elements.$document.ready(function(){new y})}(jQuery)}();
